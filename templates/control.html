<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Overlay Control Panel</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 20px;
            color: #fff;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #00d4ff;
        }
        .section-title {
            text-align: center;
            margin: 40px 0 20px;
            font-size: 1.5rem;
            border-bottom: 2px solid;
            padding-bottom: 10px;
        }
        .section-title.cyan { color: #00d4ff; border-color: #00d4ff; }
        .section-title.orange { color: #ff9f43; border-color: #ff9f43; }
        .section-title.purple { color: #a855f7; border-color: #a855f7; }
        .section-title.green { color: #22c55e; border-color: #22c55e; }
        .section-title.pink { color: #ec4899; border-color: #ec4899; }
        .section-title.red { color: #ef4444; border-color: #ef4444; }
        .control-group {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .control-group h2 {
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        .control-group.cyan h2 { color: #00d4ff; }
        .control-group.orange h2 { color: #ff9f43; }
        .control-group.purple h2 { color: #a855f7; }
        .control-group.green h2 { color: #22c55e; }
        .control-group.pink h2 { color: #ec4899; }
        .control-group.red h2 { color: #ef4444; }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        input[type="text"], input[type="url"], input[type="color"], select, input[type="number"], input[type="range"] {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.15);
            color: #fff;
            font-size: 1rem;
            margin-bottom: 15px;
        }
        input[type="color"] {
            height: 50px;
            cursor: pointer;
        }
        input[type="range"] {
            padding: 5px;
        }
        input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        select {
            cursor: pointer;
        }
        select option {
            background: #1a1a2e;
            color: #fff;
        }
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        button {
            flex: 1;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .btn-show {
            background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
            color: #000;
        }
        .btn-show:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 212, 255, 0.4);
        }
        .btn-hide {
            background: linear-gradient(135deg, #ff4757 0%, #cc0000 100%);
            color: #fff;
        }
        .btn-hide:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 71, 87, 0.4);
        }
        .btn-update {
            background: linear-gradient(135deg, #2ed573 0%, #1e9c50 100%);
            color: #000;
        }
        .btn-update:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(46, 213, 115, 0.4);
        }
        .btn-refresh {
            background: linear-gradient(135deg, #ff9f43 0%, #cc7a00 100%);
            color: #000;
        }
        .btn-refresh:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 159, 67, 0.4);
        }
        .status {
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-weight: 600;
        }
        .status.visible {
            background: rgba(46, 213, 115, 0.2);
            border: 2px solid #2ed573;
        }
        .status.hidden {
            background: rgba(255, 71, 87, 0.2);
            border: 2px solid #ff4757;
        }
        .preview-box {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 12px;
            padding: 40px;
            margin-top: 20px;
            position: relative;
            min-height: 200px;
        }
        .preview-lt {
            position: absolute;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.9) 0%, rgba(30, 30, 30, 0.9) 100%);
            border-left: 4px solid #00d4ff;
            padding: 15px 25px;
            transition: all 0.3s ease;
        }
        .preview-lt .line1 {
            font-weight: 700;
            color: #fff;
        }
        .preview-lt .line2 {
            color: #00d4ff;
            margin-top: 5px;
        }
        .display-link {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
        }
        .display-link a {
            color: #00d4ff;
            text-decoration: none;
            font-size: 1.1rem;
        }
        .display-link a:hover {
            text-decoration: underline;
        }
        .row {
            display: flex;
            gap: 15px;
        }
        .row > div {
            flex: 1;
        }
        .feed-items {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            max-height: 150px;
            overflow-y: auto;
            font-size: 0.9rem;
        }
        .feed-items p {
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .feed-items p:last-child {
            border-bottom: none;
        }
        .ticker-preview {
            background: rgba(0, 0, 0, 0.8);
            padding: 15px 20px;
            overflow: hidden;
            white-space: nowrap;
            border-left: 4px solid #ff9f43;
        }
        .ticker-preview span {
            display: inline-block;
            animation: scroll 120s linear infinite;
        }
        .ticker-preview.speed-slow span { animation-duration: 1000s; }
        .ticker-preview.speed-medium span { animation-duration: 120s; }
        .ticker-preview.speed-fast span { animation-duration: 45s; }
        @keyframes scroll {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
        .logo-preview {
            width: 80px;
            height: 80px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        .logo-preview img {
            max-width: 100%;
            max-height: 100%;
        }
        .title-card-preview {
            padding: 40px;
            text-align: center;
            border-radius: 8px;
        }
        .title-card-preview h3 {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        .title-card-preview p {
            font-size: 1.2rem;
            opacity: 0.8;
        }
        .breaking-preview {
            background: #dc2626;
            color: white;
            padding: 15px 20px;
            font-weight: bold;
            text-align: center;
            animation: pulse 1s ease-in-out infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .range-value {
            text-align: center;
            font-size: 0.9rem;
            margin-top: -10px;
            margin-bottom: 15px;
            color: rgba(255,255,255,0.7);
        }
        .settings-btn {
            position: fixed;
            top: 15px;
            right: 15px;
            background: #333;
            color: #fff;
            border: 1px solid #555;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            z-index: 1000;
            transition: background 0.2s;
        }
        .settings-btn:hover {
            background: #444;
            border-color: #00d4ff;
        }
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        .modal-overlay.active {
            display: flex;
        }
        .modal {
            background: #1e1e2e;
            border: 1px solid #444;
            border-radius: 16px;
            padding: 30px;
            width: 500px;
            max-width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        .modal h2 {
            color: #00d4ff;
            margin-bottom: 20px;
            font-size: 1.4rem;
        }
        .modal label {
            display: block;
            margin-top: 15px;
            margin-bottom: 5px;
            color: #ccc;
            font-size: 0.9rem;
        }
        .modal input {
            width: 100%;
            padding: 10px 12px;
            background: #2a2a3e;
            border: 1px solid #444;
            border-radius: 8px;
            color: #fff;
            font-size: 1rem;
        }
        .modal input:focus {
            outline: none;
            border-color: #00d4ff;
        }
        .modal .url-list {
            margin-top: 15px;
            background: #2a2a3e;
            border-radius: 8px;
            padding: 15px;
        }
        .modal .url-list p {
            margin: 8px 0;
            font-size: 0.85rem;
            color: #aaa;
        }
        .modal .url-list code {
            color: #00d4ff;
            background: rgba(0, 212, 255, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.85rem;
        }
        .modal .btn-row {
            display: flex;
            gap: 10px;
            margin-top: 25px;
        }
        .modal .btn-save {
            flex: 1;
            padding: 12px;
            background: linear-gradient(135deg, #00d4ff, #0099cc);
            color: #fff;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
        }
        .modal .btn-save:hover {
            opacity: 0.9;
        }
        .modal .btn-cancel {
            flex: 1;
            padding: 12px;
            background: #333;
            color: #fff;
            border: 1px solid #555;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
        }
        .modal .btn-cancel:hover {
            background: #444;
        }
        .modal .save-msg {
            margin-top: 12px;
            padding: 10px;
            border-radius: 8px;
            font-size: 0.85rem;
            display: none;
        }
        .modal .save-msg.success {
            display: block;
            background: rgba(76, 175, 80, 0.2);
            color: #4caf50;
            border: 1px solid rgba(76, 175, 80, 0.3);
        }
        .modal .save-msg.error {
            display: block;
            background: rgba(244, 67, 54, 0.2);
            color: #f44336;
            border: 1px solid rgba(244, 67, 54, 0.3);
        }
    </style>
</head>
<body>
    <button class="settings-btn" onclick="openSettings()">Settings</button>
    
    <div class="modal-overlay" id="settingsModal">
        <div class="modal">
            <h2>App Settings</h2>
            
            <label for="settingsPort">Port Number</label>
            <input type="number" id="settingsPort" value="{{ port }}" min="1" max="65535" placeholder="5000" oninput="updateUrls()">
            
            <div class="url-list">
                <p><strong>App URLs:</strong></p>
                <p>Control Panel: <code id="urlControl">http://localhost:{{ port }}/</code></p>
                <p>Display (OBS): <code id="urlDisplay">http://localhost:{{ port }}/display</code></p>
                <p>Multiview: <code id="urlMultiview">http://localhost:{{ port }}/multiview</code></p>
            </div>
            
            <div class="url-list" style="margin-top: 10px;">
                <p><strong>Docker Run Command:</strong></p>
                <p><code id="dockerCmd" style="word-break: break-all;">docker run -p {{ port }}:5000 overlay-app</code></p>
                <p style="font-size: 0.8rem; color: #888; margin-top: 5px;">In Docker, change the first number to set your port. The app always listens on 5000 internally.</p>
            </div>
            
            <div id="saveMsg" class="save-msg"></div>
            
            <div class="btn-row">
                <button class="btn-cancel" onclick="closeSettings()">Cancel</button>
                <button class="btn-save" onclick="savePort()">Save Port (Restart Required)</button>
            </div>
        </div>
    </div>
    
    <div class="container">
        <h1>Overlay Control Panel</h1>
        
        <!-- MULTIVIEW -->
        <h2 class="section-title" style="border-color: #a855f7;">Multiview Layout</h2>
        
        <div class="control-group" style="border-color: #a855f7;">
            <h2>Quadrant Assignments</h2>
            <div class="row">
                <div>
                    <label for="mvQ1" style="color: #00d4ff;">Q1 (Top Left)</label>
                    <select id="mvQ1" onchange="updateMultiviewQuadrant('q1', this.value)">
                        <option value="all">All Elements</option>
                        <option value="lowerthird">Lower Third</option>
                        <option value="ticker">RSS Ticker</option>
                        <option value="logo">Logo Bug</option>
                        <option value="titlecard">Title Card</option>
                        <option value="social">Social Bar</option>
                        <option value="breaking">Breaking News</option>
                        <option value="none">None</option>
                    </select>
                </div>
                <div>
                    <label for="mvQ2" style="color: #ff6b6b;">Q2 (Top Right)</label>
                    <select id="mvQ2" onchange="updateMultiviewQuadrant('q2', this.value)">
                        <option value="all">All Elements</option>
                        <option value="lowerthird">Lower Third</option>
                        <option value="ticker">RSS Ticker</option>
                        <option value="logo">Logo Bug</option>
                        <option value="titlecard">Title Card</option>
                        <option value="social">Social Bar</option>
                        <option value="breaking">Breaking News</option>
                        <option value="none">None</option>
                    </select>
                </div>
            </div>
            <div class="row">
                <div>
                    <label for="mvQ3" style="color: #4ecdc4;">Q3 (Bottom Left)</label>
                    <select id="mvQ3" onchange="updateMultiviewQuadrant('q3', this.value)">
                        <option value="all">All Elements</option>
                        <option value="lowerthird">Lower Third</option>
                        <option value="ticker">RSS Ticker</option>
                        <option value="logo">Logo Bug</option>
                        <option value="titlecard">Title Card</option>
                        <option value="social">Social Bar</option>
                        <option value="breaking">Breaking News</option>
                        <option value="none">None</option>
                    </select>
                </div>
                <div>
                    <label for="mvQ4" style="color: #ffd93d;">Q4 (Bottom Right)</label>
                    <select id="mvQ4" onchange="updateMultiviewQuadrant('q4', this.value)">
                        <option value="all">All Elements</option>
                        <option value="lowerthird">Lower Third</option>
                        <option value="ticker">RSS Ticker</option>
                        <option value="logo">Logo Bug</option>
                        <option value="titlecard">Title Card</option>
                        <option value="social">Social Bar</option>
                        <option value="breaking">Breaking News</option>
                        <option value="none">None</option>
                    </select>
                </div>
            </div>
        </div>
        
        <!-- LOWER THIRD -->
        <h2 class="section-title cyan">Lower Third</h2>
        
        <div class="control-group cyan">
            <h2>Text Content</h2>
            <label for="line1">Line 1 (Name)</label>
            <input type="text" id="line1" placeholder="Enter name..." value="John Smith">
            <label for="line2">Line 2 (Title)</label>
            <input type="text" id="line2" placeholder="Enter title..." value="Software Engineer">
        </div>
        
        <div class="control-group cyan">
            <h2>Image (Optional)</h2>
            <label for="ltImageUrl">Image URL (logo, headshot, etc.)</label>
            <input type="url" id="ltImageUrl" placeholder="https://example.com/photo.jpg">
            <label for="ltImageShape">Image Shape</label>
            <select id="ltImageShape">
                <option value="square">Square</option>
                <option value="circle">Circle</option>
                <option value="rounded">Rounded</option>
            </select>
        </div>
        
        <div class="control-group cyan">
            <h2>Layout</h2>
            <div class="row">
                <div>
                    <label for="position">Position</label>
                    <select id="position">
                        <option value="bottom-left">Bottom Left</option>
                        <option value="bottom-center">Bottom Center</option>
                        <option value="bottom-right">Bottom Right</option>
                        <option value="top-left">Top Left</option>
                        <option value="top-center">Top Center</option>
                        <option value="top-right">Top Right</option>
                    </select>
                </div>
                <div>
                    <label for="textSize">Text Size</label>
                    <select id="textSize">
                        <option value="small">Small</option>
                        <option value="medium" selected>Medium</option>
                        <option value="large">Large</option>
                        <option value="xlarge">Extra Large</option>
                    </select>
                </div>
            </div>
            <div class="row">
                <div>
                    <label for="ltWidth">Width</label>
                    <select id="ltWidth">
                        <option value="compact">Compact (Fit Content)</option>
                        <option value="full">Full Screen Width</option>
                    </select>
                </div>
                <div>
                    <label for="duration">Auto-hide (seconds, 0 = manual)</label>
                    <input type="number" id="duration" value="5" min="0" max="60">
                </div>
            </div>
            <div class="row">
                <div>
                    <label for="ltFont">Font</label>
                    <select id="ltFont">
                        <option value="Segoe UI">Segoe UI</option>
                        <option value="Arial">Arial</option>
                        <option value="Helvetica">Helvetica</option>
                        <option value="Georgia">Georgia</option>
                        <option value="Times New Roman">Times New Roman</option>
                        <option value="Verdana">Verdana</option>
                        <option value="Trebuchet MS">Trebuchet MS</option>
                        <option value="Impact">Impact</option>
                        <option value="Comic Sans MS">Comic Sans MS</option>
                        <option value="Courier New">Courier New</option>
                        <option value="custom">Custom Font (URL below)</option>
                    </select>
                </div>
                <div></div>
            </div>
            <label for="ltCustomFontUrl">Custom Font URL (.ttf, .otf, .woff, .woff2)</label>
            <input type="url" id="ltCustomFontUrl" placeholder="https://example.com/font.woff2">
            <label for="ltCustomFontName">Custom Font Name</label>
            <input type="text" id="ltCustomFontName" placeholder="My Custom Font">
        </div>
        
        <div class="control-group cyan">
            <h2>Style</h2>
            <label for="ltStyle">Style Preset</label>
            <select id="ltStyle">
                <option value="modern">Modern (Gradient)</option>
                <option value="classic">Classic (Solid)</option>
                <option value="minimal">Minimal (Clean)</option>
                <option value="bold">Bold (Full Width)</option>
                <option value="news">News (Bar Style)</option>
                <option value="elegant">Elegant (Thin Border)</option>
                <option value="neon">Neon (Glow Effect)</option>
                <option value="glass">Glass (Transparent)</option>
            </select>
            <div class="row">
                <div>
                    <label for="ltBgColor">Background Color</label>
                    <input type="color" id="ltBgColor" value="#1a1a2e">
                </div>
                <div>
                    <label for="ltAccentColor">Accent Color</label>
                    <input type="color" id="ltAccentColor" value="#00d4ff">
                </div>
            </div>
            <div class="row">
                <div>
                    <label for="ltTextColor">Text Color</label>
                    <input type="color" id="ltTextColor" value="#ffffff">
                </div>
                <div></div>
            </div>
        </div>
        
        <div class="button-group">
            <button class="btn-update" onclick="updateLowerThird()">Update Settings</button>
        </div>
        <div class="button-group">
            <button class="btn-show" onclick="showLowerThird()">Show</button>
            <button class="btn-hide" onclick="hideLowerThird()">Hide</button>
        </div>
        <div id="ltStatus" class="status hidden">Lower Third: Hidden</div>
        
        <!-- RSS TICKER -->
        <h2 class="section-title orange">RSS Ticker</h2>
        
        <div class="control-group orange">
            <h2>RSS Feed</h2>
            <label for="feedUrl">RSS Feed URL</label>
            <input type="url" id="feedUrl" placeholder="https://example.com/rss.xml">
            <div class="button-group">
                <button class="btn-refresh" onclick="loadFeed()">Load Feed</button>
            </div>
            <label style="margin-top: 15px;">Feed Items</label>
            <div id="feedItems" class="feed-items">
                <p>No feed loaded. Enter a URL and click "Load Feed".</p>
            </div>
        </div>
        
        <div class="control-group orange">
            <h2>Ticker Appearance</h2>
            <div class="row">
                <div>
                    <label for="tickerPosition">Position</label>
                    <select id="tickerPosition">
                        <option value="bottom">Bottom</option>
                        <option value="top">Top</option>
                    </select>
                </div>
                <div>
                    <label for="tickerTextSize">Text Size</label>
                    <select id="tickerTextSize">
                        <option value="small">Small</option>
                        <option value="medium" selected>Medium</option>
                        <option value="large">Large</option>
                    </select>
                </div>
            </div>
            <div class="row">
                <div>
                    <label for="tickerSpeed">Scroll Speed</label>
                    <select id="tickerSpeed">
                        <option value="slow">Slow</option>
                        <option value="medium" selected>Medium</option>
                        <option value="fast">Fast</option>
                    </select>
                </div>
                <div>
                    <label for="tickerFont">Font</label>
                    <select id="tickerFont">
                        <option value="Segoe UI">Segoe UI</option>
                        <option value="Arial">Arial</option>
                        <option value="Helvetica">Helvetica</option>
                        <option value="Georgia">Georgia</option>
                        <option value="Times New Roman">Times New Roman</option>
                        <option value="Verdana">Verdana</option>
                        <option value="Trebuchet MS">Trebuchet MS</option>
                        <option value="Impact">Impact</option>
                        <option value="Courier New">Courier New</option>
                    </select>
                </div>
            </div>
        </div>
        
        <div class="button-group">
            <button class="btn-update" onclick="updateTicker()">Update Ticker</button>
        </div>
        <div class="button-group">
            <button class="btn-show" onclick="showTicker()">Show</button>
            <button class="btn-hide" onclick="hideTicker()">Hide</button>
        </div>
        <div id="tickerStatus" class="status hidden">Ticker: Hidden</div>
        
        <!-- LOGO BUG -->
        <h2 class="section-title purple">Logo Bug</h2>
        
        <div class="control-group purple">
            <h2>Logo Settings</h2>
            <label for="logoUrl">Logo Image URL</label>
            <input type="url" id="logoUrl" placeholder="https://example.com/logo.png">
            <div class="row">
                <div>
                    <label for="logoPosition">Position</label>
                    <select id="logoPosition">
                        <option value="top-left">Top Left</option>
                        <option value="top-right" selected>Top Right</option>
                        <option value="bottom-left">Bottom Left</option>
                        <option value="bottom-right">Bottom Right</option>
                    </select>
                </div>
                <div>
                    <label for="logoSize">Size</label>
                    <select id="logoSize">
                        <option value="small">Small</option>
                        <option value="medium" selected>Medium</option>
                        <option value="large">Large</option>
                    </select>
                </div>
            </div>
            <label for="logoOpacity">Opacity</label>
            <input type="range" id="logoOpacity" min="10" max="100" value="100">
            <div class="range-value"><span id="opacityValue">100</span>%</div>
        </div>
        
        <div class="button-group">
            <button class="btn-update" onclick="updateLogo()">Update Logo</button>
        </div>
        <div class="button-group">
            <button class="btn-show" onclick="showLogo()">Show</button>
            <button class="btn-hide" onclick="hideLogo()">Hide</button>
        </div>
        <div id="logoStatus" class="status hidden">Logo: Hidden</div>
        
        <!-- TITLE CARD -->
        <h2 class="section-title green">Full-Screen Title Card</h2>
        
        <div class="control-group green">
            <h2>Title Card Content</h2>
            <label for="titleText">Title</label>
            <input type="text" id="titleText" placeholder="Welcome" value="Welcome">
            <label for="subtitleText">Subtitle (optional)</label>
            <input type="text" id="subtitleText" placeholder="To the show...">
            <div class="row">
                <div>
                    <label for="titleBgColor">Background Color</label>
                    <input type="color" id="titleBgColor" value="#000000">
                </div>
                <div>
                    <label for="titleTextColor">Text Color</label>
                    <input type="color" id="titleTextColor" value="#ffffff">
                </div>
            </div>
            <label for="titleBgImage">Background Image URL (optional)</label>
            <input type="url" id="titleBgImage" placeholder="https://example.com/background.jpg">
            <label for="titleFont">Font</label>
            <select id="titleFont">
                <option value="Segoe UI">Segoe UI</option>
                <option value="Arial">Arial</option>
                <option value="Helvetica">Helvetica</option>
                <option value="Georgia">Georgia</option>
                <option value="Times New Roman">Times New Roman</option>
                <option value="Verdana">Verdana</option>
                <option value="Trebuchet MS">Trebuchet MS</option>
                <option value="Impact">Impact</option>
                <option value="Playfair Display">Playfair Display</option>
                <option value="Courier New">Courier New</option>
            </select>
        </div>
        
        <div class="control-group green">
            <h2>Preview</h2>
            <div id="titleCardPreview" class="title-card-preview" style="background: #000; color: #fff;">
                <h3>Welcome</h3>
                <p></p>
            </div>
        </div>
        
        <div class="button-group">
            <button class="btn-update" onclick="updateTitleCard()">Update Title Card</button>
        </div>
        <div class="button-group">
            <button class="btn-show" onclick="showTitleCard()">Show</button>
            <button class="btn-hide" onclick="hideTitleCard()">Hide</button>
        </div>
        <div id="titleStatus" class="status hidden">Title Card: Hidden</div>
        
        <!-- SOCIAL MEDIA BAR -->
        <h2 class="section-title pink">Social Media Bar</h2>
        
        <div class="control-group pink">
            <h2>Social Handles</h2>
            <div class="row">
                <div>
                    <label for="socialTwitter">Twitter/X</label>
                    <input type="text" id="socialTwitter" placeholder="@username">
                </div>
                <div>
                    <label for="socialYoutube">YouTube</label>
                    <input type="text" id="socialYoutube" placeholder="@channel">
                </div>
            </div>
            <div class="row">
                <div>
                    <label for="socialInstagram">Instagram</label>
                    <input type="text" id="socialInstagram" placeholder="@username">
                </div>
                <div>
                    <label for="socialTiktok">TikTok</label>
                    <input type="text" id="socialTiktok" placeholder="@username">
                </div>
            </div>
            <div class="row">
                <div>
                    <label for="socialFacebook">Facebook</label>
                    <input type="text" id="socialFacebook" placeholder="pagename">
                </div>
                <div>
                    <label for="socialWebsite">Website</label>
                    <input type="text" id="socialWebsite" placeholder="example.com">
                </div>
            </div>
            <div class="row">
                <div>
                    <label for="socialPosition">Position</label>
                    <select id="socialPosition">
                        <option value="top">Top</option>
                        <option value="bottom" selected>Bottom</option>
                    </select>
                </div>
                <div>
                    <label for="socialFont">Font</label>
                    <select id="socialFont">
                        <option value="Segoe UI">Segoe UI</option>
                        <option value="Arial">Arial</option>
                        <option value="Helvetica">Helvetica</option>
                        <option value="Georgia">Georgia</option>
                        <option value="Verdana">Verdana</option>
                        <option value="Trebuchet MS">Trebuchet MS</option>
                        <option value="Courier New">Courier New</option>
                    </select>
                </div>
            </div>
        </div>
        
        <div class="button-group">
            <button class="btn-update" onclick="updateSocial()">Update Social Bar</button>
        </div>
        <div class="button-group">
            <button class="btn-show" onclick="showSocial()">Show</button>
            <button class="btn-hide" onclick="hideSocial()">Hide</button>
        </div>
        <div id="socialStatus" class="status hidden">Social Bar: Hidden</div>
        
        <!-- BREAKING NEWS -->
        <h2 class="section-title red">Breaking News Banner</h2>
        
        <div class="control-group red">
            <h2>Breaking News</h2>
            <label for="breakingText">Breaking News Text</label>
            <input type="text" id="breakingText" placeholder="BREAKING NEWS: ..." value="BREAKING NEWS">
            <label for="breakingFont">Font</label>
            <select id="breakingFont">
                <option value="Segoe UI">Segoe UI</option>
                <option value="Arial">Arial</option>
                <option value="Helvetica">Helvetica</option>
                <option value="Impact">Impact</option>
                <option value="Verdana">Verdana</option>
                <option value="Trebuchet MS">Trebuchet MS</option>
                <option value="Georgia">Georgia</option>
                <option value="Courier New">Courier New</option>
            </select>
        </div>
        
        <div class="control-group red">
            <h2>Preview</h2>
            <div id="breakingPreview" class="breaking-preview">BREAKING NEWS</div>
        </div>
        
        <div class="button-group">
            <button class="btn-update" onclick="updateBreaking()">Update Banner</button>
        </div>
        <div class="button-group">
            <button class="btn-show" onclick="showBreaking()">Show</button>
            <button class="btn-hide" onclick="hideBreaking()">Hide</button>
        </div>
        <div id="breakingStatus" class="status hidden">Breaking News: Hidden</div>
        
        <div class="display-link">
            <a href="/display" target="_blank">Open Display Window (for OBS/streaming)</a>
            &nbsp;|&nbsp;
            <a href="/multiview" target="_blank">Open Multiview Window</a>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.4/socket.io.min.js"></script>
    <script>
        const socket = io();
        
        socket.on('connect', () => console.log('Connected to server'));
        
        // Lower Third
        socket.on('state_update', (state) => {
            document.getElementById('line1').value = state.line1;
            document.getElementById('line2').value = state.line2;
            document.getElementById('position').value = state.position;
            document.getElementById('textSize').value = state.textSize;
            document.getElementById('duration').value = state.duration;
            document.getElementById('ltWidth').value = state.width || 'compact';
            document.getElementById('ltFont').value = state.font || 'Segoe UI';
            document.getElementById('ltCustomFontUrl').value = state.customFontUrl || '';
            document.getElementById('ltCustomFontName').value = state.customFontName || '';
            document.getElementById('ltStyle').value = state.style || 'modern';
            document.getElementById('ltBgColor').value = state.bgColor || '#1a1a2e';
            document.getElementById('ltAccentColor').value = state.accentColor || '#00d4ff';
            document.getElementById('ltTextColor').value = state.textColor || '#ffffff';
            document.getElementById('ltImageUrl').value = state.imageUrl || '';
            document.getElementById('ltImageShape').value = state.imageShape || 'square';
            updateStatus('ltStatus', 'Lower Third', state.visible);
        });
        
        function updateLowerThird() {
            fetch('/api/state', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    line1: document.getElementById('line1').value,
                    line2: document.getElementById('line2').value,
                    position: document.getElementById('position').value,
                    textSize: document.getElementById('textSize').value,
                    duration: parseInt(document.getElementById('duration').value),
                    width: document.getElementById('ltWidth').value,
                    font: document.getElementById('ltFont').value,
                    customFontUrl: document.getElementById('ltCustomFontUrl').value,
                    customFontName: document.getElementById('ltCustomFontName').value,
                    style: document.getElementById('ltStyle').value,
                    bgColor: document.getElementById('ltBgColor').value,
                    accentColor: document.getElementById('ltAccentColor').value,
                    textColor: document.getElementById('ltTextColor').value,
                    imageUrl: document.getElementById('ltImageUrl').value,
                    imageShape: document.getElementById('ltImageShape').value
                })
            });
        }
        
        function showLowerThird() { updateLowerThird(); socket.emit('show'); }
        function hideLowerThird() { socket.emit('hide'); }
        
        // Ticker
        socket.on('ticker_update', (state) => {
            document.getElementById('feedUrl').value = state.feedUrl || '';
            document.getElementById('tickerPosition').value = state.position;
            document.getElementById('tickerTextSize').value = state.textSize;
            document.getElementById('tickerSpeed').value = state.speed || 'medium';
            document.getElementById('tickerFont').value = state.font || 'Segoe UI';
            updateFeedItems(state.items);
            updateStatus('tickerStatus', 'Ticker', state.visible);
        });
        
        function loadFeed() {
            const feedUrl = document.getElementById('feedUrl').value;
            if (!feedUrl) { alert('Please enter an RSS feed URL'); return; }
            fetch('/api/ticker', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ feedUrl: feedUrl })
            }).then(res => res.json()).then(data => updateFeedItems(data.items));
        }
        
        function updateFeedItems(items) {
            const container = document.getElementById('feedItems');
            if (!items || items.length === 0) {
                container.innerHTML = '<p>No items found in feed.</p>';
                return;
            }
            container.innerHTML = items.map(item => `<p>${item}</p>`).join('');
        }
        
        function updateTicker() {
            fetch('/api/ticker', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    position: document.getElementById('tickerPosition').value,
                    textSize: document.getElementById('tickerTextSize').value,
                    speed: document.getElementById('tickerSpeed').value,
                    font: document.getElementById('tickerFont').value
                })
            });
        }
        
        function showTicker() { updateTicker(); socket.emit('ticker_show'); }
        function hideTicker() { socket.emit('ticker_hide'); }
        
        // Logo
        socket.on('logo_update', (state) => {
            document.getElementById('logoUrl').value = state.imageUrl || '';
            document.getElementById('logoPosition').value = state.position;
            document.getElementById('logoSize').value = state.size;
            document.getElementById('logoOpacity').value = state.opacity;
            document.getElementById('opacityValue').textContent = state.opacity;
            updateStatus('logoStatus', 'Logo', state.visible);
        });
        
        document.getElementById('logoOpacity').addEventListener('input', (e) => {
            document.getElementById('opacityValue').textContent = e.target.value;
        });
        
        function updateLogo() {
            fetch('/api/logo', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    imageUrl: document.getElementById('logoUrl').value,
                    position: document.getElementById('logoPosition').value,
                    size: document.getElementById('logoSize').value,
                    opacity: parseInt(document.getElementById('logoOpacity').value)
                })
            });
        }
        
        function showLogo() { updateLogo(); socket.emit('logo_show'); }
        function hideLogo() { socket.emit('logo_hide'); }
        
        // Title Card
        socket.on('titlecard_update', (state) => {
            document.getElementById('titleText').value = state.title;
            document.getElementById('subtitleText').value = state.subtitle || '';
            document.getElementById('titleBgColor').value = state.backgroundColor;
            document.getElementById('titleTextColor').value = state.textColor;
            document.getElementById('titleBgImage').value = state.backgroundImage || '';
            document.getElementById('titleFont').value = state.font || 'Segoe UI';
            updateTitlePreview();
            updateStatus('titleStatus', 'Title Card', state.visible);
        });
        
        function updateTitlePreview() {
            const preview = document.getElementById('titleCardPreview');
            const bgImage = document.getElementById('titleBgImage').value;
            if (bgImage) {
                preview.style.background = `url('${bgImage}') center/cover`;
            } else {
                preview.style.background = document.getElementById('titleBgColor').value;
            }
            preview.style.color = document.getElementById('titleTextColor').value;
            preview.style.fontFamily = document.getElementById('titleFont').value;
            preview.querySelector('h3').textContent = document.getElementById('titleText').value;
            preview.querySelector('p').textContent = document.getElementById('subtitleText').value;
        }
        
        ['titleText', 'subtitleText', 'titleBgColor', 'titleTextColor', 'titleBgImage', 'titleFont'].forEach(id => {
            document.getElementById(id).addEventListener('input', updateTitlePreview);
            document.getElementById(id).addEventListener('change', updateTitlePreview);
        });
        
        function updateTitleCard() {
            fetch('/api/titlecard', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    title: document.getElementById('titleText').value,
                    subtitle: document.getElementById('subtitleText').value,
                    backgroundColor: document.getElementById('titleBgColor').value,
                    textColor: document.getElementById('titleTextColor').value,
                    backgroundImage: document.getElementById('titleBgImage').value,
                    font: document.getElementById('titleFont').value
                })
            });
        }
        
        function showTitleCard() { updateTitleCard(); socket.emit('titlecard_show'); }
        function hideTitleCard() { socket.emit('titlecard_hide'); }
        
        // Social Bar
        socket.on('social_update', (state) => {
            document.getElementById('socialTwitter').value = state.twitter || '';
            document.getElementById('socialYoutube').value = state.youtube || '';
            document.getElementById('socialInstagram').value = state.instagram || '';
            document.getElementById('socialTiktok').value = state.tiktok || '';
            document.getElementById('socialFacebook').value = state.facebook || '';
            document.getElementById('socialWebsite').value = state.website || '';
            document.getElementById('socialPosition').value = state.position;
            document.getElementById('socialFont').value = state.font || 'Segoe UI';
            updateStatus('socialStatus', 'Social Bar', state.visible);
        });
        
        function updateSocial() {
            fetch('/api/social', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    twitter: document.getElementById('socialTwitter').value,
                    youtube: document.getElementById('socialYoutube').value,
                    instagram: document.getElementById('socialInstagram').value,
                    tiktok: document.getElementById('socialTiktok').value,
                    facebook: document.getElementById('socialFacebook').value,
                    website: document.getElementById('socialWebsite').value,
                    position: document.getElementById('socialPosition').value,
                    font: document.getElementById('socialFont').value
                })
            });
        }
        
        function showSocial() { updateSocial(); socket.emit('social_show'); }
        function hideSocial() { socket.emit('social_hide'); }
        
        // Breaking News
        socket.on('breaking_update', (state) => {
            document.getElementById('breakingText').value = state.text;
            document.getElementById('breakingFont').value = state.font || 'Segoe UI';
            document.getElementById('breakingPreview').textContent = state.text;
            document.getElementById('breakingPreview').style.fontFamily = state.font || 'Segoe UI';
            updateStatus('breakingStatus', 'Breaking News', state.visible);
        });
        
        document.getElementById('breakingText').addEventListener('input', (e) => {
            document.getElementById('breakingPreview').textContent = e.target.value;
        });
        
        document.getElementById('breakingFont').addEventListener('change', (e) => {
            document.getElementById('breakingPreview').style.fontFamily = e.target.value;
        });
        
        function updateBreaking() {
            fetch('/api/breaking', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    text: document.getElementById('breakingText').value,
                    font: document.getElementById('breakingFont').value
                })
            });
        }
        
        function showBreaking() { updateBreaking(); socket.emit('breaking_show'); }
        function hideBreaking() { socket.emit('breaking_hide'); }
        
        // Multiview
        socket.on('multiview_update', (state) => {
            document.getElementById('mvQ1').value = state.q1 || 'all';
            document.getElementById('mvQ2').value = state.q2 || 'all';
            document.getElementById('mvQ3').value = state.q3 || 'all';
            document.getElementById('mvQ4').value = state.q4 || 'all';
        });
        
        function updateMultiviewQuadrant(quadrant, value) {
            fetch('/api/multiview/set?' + quadrant + '=' + value);
        }
        
        // Settings
        function openSettings() {
            document.getElementById('settingsModal').classList.add('active');
            document.getElementById('saveMsg').className = 'save-msg';
            document.getElementById('saveMsg').textContent = '';
        }
        
        function closeSettings() {
            document.getElementById('settingsModal').classList.remove('active');
        }
        
        function updateUrls() {
            const port = document.getElementById('settingsPort').value || '5000';
            document.getElementById('urlControl').textContent = 'http://localhost:' + port + '/';
            document.getElementById('urlDisplay').textContent = 'http://localhost:' + port + '/display';
            document.getElementById('urlMultiview').textContent = 'http://localhost:' + port + '/multiview';
            document.getElementById('dockerCmd').textContent = 'docker run -p ' + port + ':5000 overlay-app';
        }
        
        function savePort() {
            const port = document.getElementById('settingsPort').value;
            const msg = document.getElementById('saveMsg');
            fetch('/api/config/port?port=' + port)
                .then(r => r.json())
                .then(data => {
                    if (data.status === 'ok') {
                        msg.className = 'save-msg success';
                        msg.textContent = 'Port saved to ' + data.port + '. When running locally, restart the app. In Docker, use: docker run -p ' + data.port + ':5000 overlay-app';
                    } else {
                        msg.className = 'save-msg error';
                        msg.textContent = data.error || 'Failed to save port.';
                    }
                })
                .catch(() => {
                    msg.className = 'save-msg error';
                    msg.textContent = 'Failed to save port.';
                });
        }
        
        document.getElementById('settingsModal').addEventListener('click', function(e) {
            if (e.target === this) closeSettings();
        });
        
        // Helper
        function updateStatus(elementId, name, visible) {
            const status = document.getElementById(elementId);
            status.className = visible ? 'status visible' : 'status hidden';
            status.textContent = `${name}: ${visible ? 'Visible' : 'Hidden'}`;
        }
    </script>
</body>
</html>
