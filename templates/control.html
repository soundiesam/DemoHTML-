<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Overlay Control Panel</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            padding: 20px;
            color: #fff;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #00d4ff;
        }
        .section-title {
            text-align: center;
            margin: 40px 0 20px;
            font-size: 1.5rem;
            border-bottom: 2px solid;
            padding-bottom: 10px;
        }
        .section-title.cyan { color: #00d4ff; border-color: #00d4ff; }
        .section-title.orange { color: #ff9f43; border-color: #ff9f43; }
        .section-title.purple { color: #a855f7; border-color: #a855f7; }
        .section-title.green { color: #22c55e; border-color: #22c55e; }
        .section-title.pink { color: #ec4899; border-color: #ec4899; }
        .section-title.red { color: #ef4444; border-color: #ef4444; }
        .control-group {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .control-group h2 {
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        .control-group.cyan h2 { color: #00d4ff; }
        .control-group.orange h2 { color: #ff9f43; }
        .control-group.purple h2 { color: #a855f7; }
        .control-group.green h2 { color: #22c55e; }
        .control-group.pink h2 { color: #ec4899; }
        .control-group.red h2 { color: #ef4444; }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        input[type="text"], input[type="url"], input[type="color"], select, input[type="number"], input[type="range"] {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.15);
            color: #fff;
            font-size: 1rem;
            margin-bottom: 15px;
        }
        input[type="color"] {
            height: 50px;
            cursor: pointer;
        }
        input[type="range"] {
            padding: 5px;
        }
        input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        select {
            cursor: pointer;
        }
        select option {
            background: #1a1a2e;
            color: #fff;
        }
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        button {
            flex: 1;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .btn-show {
            background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
            color: #000;
        }
        .btn-show:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 212, 255, 0.4);
        }
        .btn-hide {
            background: linear-gradient(135deg, #ff4757 0%, #cc0000 100%);
            color: #fff;
        }
        .btn-hide:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 71, 87, 0.4);
        }
        .btn-update {
            background: linear-gradient(135deg, #2ed573 0%, #1e9c50 100%);
            color: #000;
        }
        .btn-update:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(46, 213, 115, 0.4);
        }
        .btn-refresh {
            background: linear-gradient(135deg, #ff9f43 0%, #cc7a00 100%);
            color: #000;
        }
        .btn-refresh:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(255, 159, 67, 0.4);
        }
        .status {
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-weight: 600;
        }
        .status.visible {
            background: rgba(46, 213, 115, 0.2);
            border: 2px solid #2ed573;
        }
        .status.hidden {
            background: rgba(255, 71, 87, 0.2);
            border: 2px solid #ff4757;
        }
        .preview-box {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 12px;
            padding: 40px;
            margin-top: 20px;
            position: relative;
            min-height: 200px;
        }
        .preview-lt {
            position: absolute;
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.9) 0%, rgba(30, 30, 30, 0.9) 100%);
            border-left: 4px solid #00d4ff;
            padding: 15px 25px;
            transition: all 0.3s ease;
        }
        .preview-lt .line1 {
            font-weight: 700;
            color: #fff;
        }
        .preview-lt .line2 {
            color: #00d4ff;
            margin-top: 5px;
        }
        .display-link {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
        }
        .display-link a {
            color: #00d4ff;
            text-decoration: none;
            font-size: 1.1rem;
        }
        .display-link a:hover {
            text-decoration: underline;
        }
        .row {
            display: flex;
            gap: 15px;
        }
        .row > div {
            flex: 1;
        }
        .feed-items {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            max-height: 150px;
            overflow-y: auto;
            font-size: 0.9rem;
        }
        .feed-items p {
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .feed-items p:last-child {
            border-bottom: none;
        }
        .ticker-preview {
            background: rgba(0, 0, 0, 0.8);
            padding: 15px 20px;
            overflow: hidden;
            white-space: nowrap;
            border-left: 4px solid #ff9f43;
        }
        .ticker-preview span {
            display: inline-block;
            animation: scroll 120s linear infinite;
        }
        .ticker-preview.speed-slow span { animation-duration: 1000s; }
        .ticker-preview.speed-medium span { animation-duration: 120s; }
        .ticker-preview.speed-fast span { animation-duration: 45s; }
        @keyframes scroll {
            0% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }
        .logo-preview {
            width: 80px;
            height: 80px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        .logo-preview img {
            max-width: 100%;
            max-height: 100%;
        }
        .title-card-preview {
            padding: 40px;
            text-align: center;
            border-radius: 8px;
        }
        .title-card-preview h3 {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        .title-card-preview p {
            font-size: 1.2rem;
            opacity: 0.8;
        }
        .breaking-preview {
            background: #dc2626;
            color: white;
            padding: 15px 20px;
            font-weight: bold;
            text-align: center;
            animation: pulse 1s ease-in-out infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .range-value {
            text-align: center;
            font-size: 0.9rem;
            margin-top: -10px;
            margin-bottom: 15px;
            color: rgba(255,255,255,0.7);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Overlay Control Panel</h1>
        
        <!-- LOWER THIRD -->
        <h2 class="section-title cyan">Lower Third</h2>
        
        <div class="control-group cyan">
            <h2>Text Content</h2>
            <label for="line1">Line 1 (Name)</label>
            <input type="text" id="line1" placeholder="Enter name..." value="John Smith">
            <label for="line2">Line 2 (Title)</label>
            <input type="text" id="line2" placeholder="Enter title..." value="Software Engineer">
        </div>
        
        <div class="control-group cyan">
            <h2>Appearance</h2>
            <div class="row">
                <div>
                    <label for="position">Position</label>
                    <select id="position">
                        <option value="bottom-left">Bottom Left</option>
                        <option value="bottom-center">Bottom Center</option>
                        <option value="bottom-right">Bottom Right</option>
                        <option value="top-left">Top Left</option>
                        <option value="top-center">Top Center</option>
                        <option value="top-right">Top Right</option>
                    </select>
                </div>
                <div>
                    <label for="textSize">Text Size</label>
                    <select id="textSize">
                        <option value="small">Small</option>
                        <option value="medium" selected>Medium</option>
                        <option value="large">Large</option>
                        <option value="xlarge">Extra Large</option>
                    </select>
                </div>
            </div>
            <label for="duration">Auto-hide Duration (seconds, 0 = manual)</label>
            <input type="number" id="duration" value="5" min="0" max="60">
        </div>
        
        <div class="button-group">
            <button class="btn-update" onclick="updateLowerThird()">Update Settings</button>
        </div>
        <div class="button-group">
            <button class="btn-show" onclick="showLowerThird()">Show</button>
            <button class="btn-hide" onclick="hideLowerThird()">Hide</button>
        </div>
        <div id="ltStatus" class="status hidden">Lower Third: Hidden</div>
        
        <!-- RSS TICKER -->
        <h2 class="section-title orange">RSS Ticker</h2>
        
        <div class="control-group orange">
            <h2>RSS Feed</h2>
            <label for="feedUrl">RSS Feed URL</label>
            <input type="url" id="feedUrl" placeholder="https://example.com/rss.xml">
            <div class="button-group">
                <button class="btn-refresh" onclick="loadFeed()">Load Feed</button>
            </div>
            <label style="margin-top: 15px;">Feed Items</label>
            <div id="feedItems" class="feed-items">
                <p>No feed loaded. Enter a URL and click "Load Feed".</p>
            </div>
        </div>
        
        <div class="control-group orange">
            <h2>Ticker Appearance</h2>
            <div class="row">
                <div>
                    <label for="tickerPosition">Position</label>
                    <select id="tickerPosition">
                        <option value="bottom">Bottom</option>
                        <option value="top">Top</option>
                    </select>
                </div>
                <div>
                    <label for="tickerTextSize">Text Size</label>
                    <select id="tickerTextSize">
                        <option value="small">Small</option>
                        <option value="medium" selected>Medium</option>
                        <option value="large">Large</option>
                    </select>
                </div>
            </div>
            <div class="row">
                <div>
                    <label for="tickerSpeed">Scroll Speed</label>
                    <select id="tickerSpeed">
                        <option value="slow">Slow</option>
                        <option value="medium" selected>Medium</option>
                        <option value="fast">Fast</option>
                    </select>
                </div>
                <div></div>
            </div>
        </div>
        
        <div class="button-group">
            <button class="btn-update" onclick="updateTicker()">Update Ticker</button>
        </div>
        <div class="button-group">
            <button class="btn-show" onclick="showTicker()">Show</button>
            <button class="btn-hide" onclick="hideTicker()">Hide</button>
        </div>
        <div id="tickerStatus" class="status hidden">Ticker: Hidden</div>
        
        <!-- LOGO BUG -->
        <h2 class="section-title purple">Logo Bug</h2>
        
        <div class="control-group purple">
            <h2>Logo Settings</h2>
            <label for="logoUrl">Logo Image URL</label>
            <input type="url" id="logoUrl" placeholder="https://example.com/logo.png">
            <div class="row">
                <div>
                    <label for="logoPosition">Position</label>
                    <select id="logoPosition">
                        <option value="top-left">Top Left</option>
                        <option value="top-right" selected>Top Right</option>
                        <option value="bottom-left">Bottom Left</option>
                        <option value="bottom-right">Bottom Right</option>
                    </select>
                </div>
                <div>
                    <label for="logoSize">Size</label>
                    <select id="logoSize">
                        <option value="small">Small</option>
                        <option value="medium" selected>Medium</option>
                        <option value="large">Large</option>
                    </select>
                </div>
            </div>
            <label for="logoOpacity">Opacity</label>
            <input type="range" id="logoOpacity" min="10" max="100" value="100">
            <div class="range-value"><span id="opacityValue">100</span>%</div>
        </div>
        
        <div class="button-group">
            <button class="btn-update" onclick="updateLogo()">Update Logo</button>
        </div>
        <div class="button-group">
            <button class="btn-show" onclick="showLogo()">Show</button>
            <button class="btn-hide" onclick="hideLogo()">Hide</button>
        </div>
        <div id="logoStatus" class="status hidden">Logo: Hidden</div>
        
        <!-- TITLE CARD -->
        <h2 class="section-title green">Full-Screen Title Card</h2>
        
        <div class="control-group green">
            <h2>Title Card Content</h2>
            <label for="titleText">Title</label>
            <input type="text" id="titleText" placeholder="Welcome" value="Welcome">
            <label for="subtitleText">Subtitle (optional)</label>
            <input type="text" id="subtitleText" placeholder="To the show...">
            <div class="row">
                <div>
                    <label for="titleBgColor">Background Color</label>
                    <input type="color" id="titleBgColor" value="#000000">
                </div>
                <div>
                    <label for="titleTextColor">Text Color</label>
                    <input type="color" id="titleTextColor" value="#ffffff">
                </div>
            </div>
        </div>
        
        <div class="control-group green">
            <h2>Preview</h2>
            <div id="titleCardPreview" class="title-card-preview" style="background: #000; color: #fff;">
                <h3>Welcome</h3>
                <p></p>
            </div>
        </div>
        
        <div class="button-group">
            <button class="btn-update" onclick="updateTitleCard()">Update Title Card</button>
        </div>
        <div class="button-group">
            <button class="btn-show" onclick="showTitleCard()">Show</button>
            <button class="btn-hide" onclick="hideTitleCard()">Hide</button>
        </div>
        <div id="titleStatus" class="status hidden">Title Card: Hidden</div>
        
        <!-- SOCIAL MEDIA BAR -->
        <h2 class="section-title pink">Social Media Bar</h2>
        
        <div class="control-group pink">
            <h2>Social Handles</h2>
            <div class="row">
                <div>
                    <label for="socialTwitter">Twitter/X</label>
                    <input type="text" id="socialTwitter" placeholder="@username">
                </div>
                <div>
                    <label for="socialYoutube">YouTube</label>
                    <input type="text" id="socialYoutube" placeholder="@channel">
                </div>
            </div>
            <div class="row">
                <div>
                    <label for="socialInstagram">Instagram</label>
                    <input type="text" id="socialInstagram" placeholder="@username">
                </div>
                <div>
                    <label for="socialTiktok">TikTok</label>
                    <input type="text" id="socialTiktok" placeholder="@username">
                </div>
            </div>
            <div class="row">
                <div>
                    <label for="socialFacebook">Facebook</label>
                    <input type="text" id="socialFacebook" placeholder="pagename">
                </div>
                <div>
                    <label for="socialWebsite">Website</label>
                    <input type="text" id="socialWebsite" placeholder="example.com">
                </div>
            </div>
            <label for="socialPosition">Position</label>
            <select id="socialPosition">
                <option value="top">Top</option>
                <option value="bottom" selected>Bottom</option>
            </select>
        </div>
        
        <div class="button-group">
            <button class="btn-update" onclick="updateSocial()">Update Social Bar</button>
        </div>
        <div class="button-group">
            <button class="btn-show" onclick="showSocial()">Show</button>
            <button class="btn-hide" onclick="hideSocial()">Hide</button>
        </div>
        <div id="socialStatus" class="status hidden">Social Bar: Hidden</div>
        
        <!-- BREAKING NEWS -->
        <h2 class="section-title red">Breaking News Banner</h2>
        
        <div class="control-group red">
            <h2>Breaking News</h2>
            <label for="breakingText">Breaking News Text</label>
            <input type="text" id="breakingText" placeholder="BREAKING NEWS: ..." value="BREAKING NEWS">
        </div>
        
        <div class="control-group red">
            <h2>Preview</h2>
            <div id="breakingPreview" class="breaking-preview">BREAKING NEWS</div>
        </div>
        
        <div class="button-group">
            <button class="btn-update" onclick="updateBreaking()">Update Banner</button>
        </div>
        <div class="button-group">
            <button class="btn-show" onclick="showBreaking()">Show</button>
            <button class="btn-hide" onclick="hideBreaking()">Hide</button>
        </div>
        <div id="breakingStatus" class="status hidden">Breaking News: Hidden</div>
        
        <div class="display-link">
            <a href="/display" target="_blank">Open Display Window (for OBS/streaming)</a>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.4/socket.io.min.js"></script>
    <script>
        const socket = io();
        
        socket.on('connect', () => console.log('Connected to server'));
        
        // Lower Third
        socket.on('state_update', (state) => {
            document.getElementById('line1').value = state.line1;
            document.getElementById('line2').value = state.line2;
            document.getElementById('position').value = state.position;
            document.getElementById('textSize').value = state.textSize;
            document.getElementById('duration').value = state.duration;
            updateStatus('ltStatus', 'Lower Third', state.visible);
        });
        
        function updateLowerThird() {
            fetch('/api/state', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    line1: document.getElementById('line1').value,
                    line2: document.getElementById('line2').value,
                    position: document.getElementById('position').value,
                    textSize: document.getElementById('textSize').value,
                    duration: parseInt(document.getElementById('duration').value)
                })
            });
        }
        
        function showLowerThird() { updateLowerThird(); socket.emit('show'); }
        function hideLowerThird() { socket.emit('hide'); }
        
        // Ticker
        socket.on('ticker_update', (state) => {
            document.getElementById('feedUrl').value = state.feedUrl || '';
            document.getElementById('tickerPosition').value = state.position;
            document.getElementById('tickerTextSize').value = state.textSize;
            document.getElementById('tickerSpeed').value = state.speed || 'medium';
            updateFeedItems(state.items);
            updateStatus('tickerStatus', 'Ticker', state.visible);
        });
        
        function loadFeed() {
            const feedUrl = document.getElementById('feedUrl').value;
            if (!feedUrl) { alert('Please enter an RSS feed URL'); return; }
            fetch('/api/ticker', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ feedUrl: feedUrl })
            }).then(res => res.json()).then(data => updateFeedItems(data.items));
        }
        
        function updateFeedItems(items) {
            const container = document.getElementById('feedItems');
            if (!items || items.length === 0) {
                container.innerHTML = '<p>No items found in feed.</p>';
                return;
            }
            container.innerHTML = items.map(item => `<p>${item}</p>`).join('');
        }
        
        function updateTicker() {
            fetch('/api/ticker', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    position: document.getElementById('tickerPosition').value,
                    textSize: document.getElementById('tickerTextSize').value,
                    speed: document.getElementById('tickerSpeed').value
                })
            });
        }
        
        function showTicker() { updateTicker(); socket.emit('ticker_show'); }
        function hideTicker() { socket.emit('ticker_hide'); }
        
        // Logo
        socket.on('logo_update', (state) => {
            document.getElementById('logoUrl').value = state.imageUrl || '';
            document.getElementById('logoPosition').value = state.position;
            document.getElementById('logoSize').value = state.size;
            document.getElementById('logoOpacity').value = state.opacity;
            document.getElementById('opacityValue').textContent = state.opacity;
            updateStatus('logoStatus', 'Logo', state.visible);
        });
        
        document.getElementById('logoOpacity').addEventListener('input', (e) => {
            document.getElementById('opacityValue').textContent = e.target.value;
        });
        
        function updateLogo() {
            fetch('/api/logo', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    imageUrl: document.getElementById('logoUrl').value,
                    position: document.getElementById('logoPosition').value,
                    size: document.getElementById('logoSize').value,
                    opacity: parseInt(document.getElementById('logoOpacity').value)
                })
            });
        }
        
        function showLogo() { updateLogo(); socket.emit('logo_show'); }
        function hideLogo() { socket.emit('logo_hide'); }
        
        // Title Card
        socket.on('titlecard_update', (state) => {
            document.getElementById('titleText').value = state.title;
            document.getElementById('subtitleText').value = state.subtitle || '';
            document.getElementById('titleBgColor').value = state.backgroundColor;
            document.getElementById('titleTextColor').value = state.textColor;
            updateTitlePreview();
            updateStatus('titleStatus', 'Title Card', state.visible);
        });
        
        function updateTitlePreview() {
            const preview = document.getElementById('titleCardPreview');
            preview.style.background = document.getElementById('titleBgColor').value;
            preview.style.color = document.getElementById('titleTextColor').value;
            preview.querySelector('h3').textContent = document.getElementById('titleText').value;
            preview.querySelector('p').textContent = document.getElementById('subtitleText').value;
        }
        
        ['titleText', 'subtitleText', 'titleBgColor', 'titleTextColor'].forEach(id => {
            document.getElementById(id).addEventListener('input', updateTitlePreview);
        });
        
        function updateTitleCard() {
            fetch('/api/titlecard', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    title: document.getElementById('titleText').value,
                    subtitle: document.getElementById('subtitleText').value,
                    backgroundColor: document.getElementById('titleBgColor').value,
                    textColor: document.getElementById('titleTextColor').value
                })
            });
        }
        
        function showTitleCard() { updateTitleCard(); socket.emit('titlecard_show'); }
        function hideTitleCard() { socket.emit('titlecard_hide'); }
        
        // Social Bar
        socket.on('social_update', (state) => {
            document.getElementById('socialTwitter').value = state.twitter || '';
            document.getElementById('socialYoutube').value = state.youtube || '';
            document.getElementById('socialInstagram').value = state.instagram || '';
            document.getElementById('socialTiktok').value = state.tiktok || '';
            document.getElementById('socialFacebook').value = state.facebook || '';
            document.getElementById('socialWebsite').value = state.website || '';
            document.getElementById('socialPosition').value = state.position;
            updateStatus('socialStatus', 'Social Bar', state.visible);
        });
        
        function updateSocial() {
            fetch('/api/social', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    twitter: document.getElementById('socialTwitter').value,
                    youtube: document.getElementById('socialYoutube').value,
                    instagram: document.getElementById('socialInstagram').value,
                    tiktok: document.getElementById('socialTiktok').value,
                    facebook: document.getElementById('socialFacebook').value,
                    website: document.getElementById('socialWebsite').value,
                    position: document.getElementById('socialPosition').value
                })
            });
        }
        
        function showSocial() { updateSocial(); socket.emit('social_show'); }
        function hideSocial() { socket.emit('social_hide'); }
        
        // Breaking News
        socket.on('breaking_update', (state) => {
            document.getElementById('breakingText').value = state.text;
            document.getElementById('breakingPreview').textContent = state.text;
            updateStatus('breakingStatus', 'Breaking News', state.visible);
        });
        
        document.getElementById('breakingText').addEventListener('input', (e) => {
            document.getElementById('breakingPreview').textContent = e.target.value;
        });
        
        function updateBreaking() {
            fetch('/api/breaking', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    text: document.getElementById('breakingText').value
                })
            });
        }
        
        function showBreaking() { updateBreaking(); socket.emit('breaking_show'); }
        function hideBreaking() { socket.emit('breaking_hide'); }
        
        // Helper
        function updateStatus(elementId, name, visible) {
            const status = document.getElementById(elementId);
            status.className = visible ? 'status visible' : 'status hidden';
            status.textContent = `${name}: ${visible ? 'Visible' : 'Hidden'}`;
        }
    </script>
</body>
</html>
